# Инструкция по настройке и запуску бота

## Шаг 1: Установка зависимостей

1. Убедитесь, что у вас установлен Python 3.8 или выше:
```bash
python --version
```

2. Создайте виртуальное окружение:
```bash
python -m venv .venv
```

3. Активируйте виртуальное окружение:
```bash
# macOS/Linux:
source .venv/bin/activate

# Windows:
.venv\Scripts\activate
```

4. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Шаг 2: Настройка переменных окружения

Файл `.env` уже настроен с необходимыми параметрами:

```env
TELEGRAM_BOT_TOKEN=8358987328:AAGXZJ7grHfhIGG5z89mKdEy7tAYbeLy7Dk
API_URL=http://demo.nikta.ai/llm/api/run
```

**Важно:** Токен для API получается автоматически перед каждым запросом с использованием встроенных учетных данных (email: `admin@nikta.ai`, password: `lAz32RA9B`).

## Шаг 3: Запуск бота

После настройки переменных окружения запустите бота:

```bash
python bot.py
```

Если всё настроено правильно, вы увидите сообщение:
```
INFO - Bot started
```

## Тестирование бота

1. Откройте Telegram
2. Найдите вашего бота по имени пользователя
3. Отправьте команду `/start`
4. Следуйте инструкциям бота

## Структура проекта

```
new-bot-for-conf/
├── bot.py              # Основной файл бота
├── requirements.txt    # Зависимости Python
├── .env               # Переменные окружения (не коммитится)
├── .gitignore         # Игнорируемые файлы для Git
├── README.md          # Основная документация
├── SETUP.md           # Инструкция по настройке
└── TZ.md              # Техническое задание
```

## Функционал бота

### Фаза 1: Выбор предсказания и сферы
- Приветственное сообщение
- 12 вариантов предсказаний для бизнеса
- 6 сфер деятельности

### Фаза 2: Работа с AI
- Интеграция с внешним API для генерации персонализированных ответов
- Возможность продолжить диалог с AI
- Выбор дальнейшего действия

### Фаза 3: Сбор контактов
- Запрос имени пользователя
- Выбор способа связи (телефон или email)
- Валидация email
- Финальное сообщение с полезными ссылками

## Особенности реализации

1. **Управление состоянием**: Используется ConversationHandler для управления состояниями диалога
2. **Удаление сообщений**: Сообщения с кнопками автоматически удаляются после выбора
3. **Валидация**: Проверка корректности введённого email
4. **Уникальные диалоги**: Каждая сессия получает уникальный dialog_id для API
5. **Перезапуск**: Команда /start в любой момент начинает диалог заново

## Возможные проблемы и решения

### Бот не запускается
- Проверьте, что активировано виртуальное окружение
- Убедитесь, что все зависимости установлены
- Проверьте правильность токена в `.env`

### API не отвечает
- Проверьте доступность API по адресу http://demo.nikta.ai/llm/api/run
- Проверьте доступность сервиса авторизации https://demo.nikta.ai/llm/api/login
- Проверьте логи бота на наличие ошибок авторизации

### Кнопки не работают
- Убедитесь, что используете последнюю версию python-telegram-bot (20.7)
- Проверьте, что бот имеет права на удаление сообщений

## Логирование

Бот ведёт логи всех действий. Уровень логирования можно изменить в файле `bot.py`:

```python
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO  # Измените на logging.DEBUG для детальных логов
)
```

## Безопасность

- Никогда не коммитьте файл `.env` в Git
- Храните токены в безопасном месте
- Регулярно обновляйте зависимости для получения патчей безопасности

## Поддержка

При возникновении проблем проверьте:
1. Логи бота
2. Правильность настройки переменных окружения
3. Доступность API
4. Версии установленных библиотек

